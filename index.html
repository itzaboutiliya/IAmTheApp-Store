<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ImTheApp Store</title>
<style>
  body { font-family: Arial, sans-serif; margin: 0; padding: 10px; background: #f4f4f4; }
  header { text-align: center; margin-bottom: 15px; }
  header img { height: 60px; }
  h1 { margin: 5px 0; font-size: 22px; }
  .lang-buttons, .tabs { text-align: center; margin: 10px 0; }
  .lang-button, .tab-button {
    background: #007aff; color: white; border: none; padding: 8px 12px; margin: 2px;
    border-radius: 4px; cursor: pointer; font-size: 14px;
  }
  .tab-button.active { background: #004bb5; }
  #searchBox {
    width: 90%; max-width: 400px; padding: 8px; margin: 10px auto; display: block;
    border-radius: 5px; border: 1px solid #ccc;
  }
  #appList { max-width: 600px; margin: auto; }
  .app-item {
    background: white; padding: 10px; margin: 8px 0; border-radius: 6px;
    display: flex; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  .app-icon { width: 60px; height: 60px; border-radius: 10px; margin-right: 10px; background: #ccc; }
  .app-info { flex-grow: 1; }
  .app-name { font-size: 16px; margin: 0; }
  .app-source { font-size: 12px; color: gray; margin: 3px 0 0 0; }
  .install-button {
    background: #28a745; color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer;
  }
</style>
</head>
<body>

<header>
  <img src="https://i.postimg.cc/fT8yVv7W/1754473252110.png" alt="logo" />
  <h1 id="title">📱 ImTheApp Store</h1>
  <div class="lang-buttons">
    <button class="lang-button" onclick="setLang('en')">English</button>
    <button class="lang-button" onclick="setLang('fa')">فارسی</button>
  </div>
</header>

<div class="tabs">
  <button class="tab-button active" onclick="setVersion('6', this)">iOS 6</button>
  <button class="tab-button" onclick="setVersion('7', this)">iOS 7</button>
  <button class="tab-button" onclick="setVersion('8', this)">iOS 8</button>
  <button class="tab-button" onclick="setVersion('9', this)">iOS 9</button>
</div>

<input type="text" id="searchBox" placeholder="Search apps..." onkeyup="renderApps()" />

<div id="appList">Loading apps...</div>

<script>
  var appsData = [];
  var currentLang = 'en';
  var currentVersion = '6';

  function setLang(lang) {
    currentLang = lang;
    document.body.dir = (lang === 'fa') ? 'rtl' : 'ltr';
    document.getElementById('title').innerHTML = (lang === 'fa') ? '📱 فروشگاه ImTheApp' : '📱 ImTheApp Store';
    renderApps();
  }

  function setVersion(ver, btn) {
    currentVersion = ver;
    var allTabs = document.getElementsByClassName('tab-button');
    for (var i = 0; i < allTabs.length; i++) {
      allTabs[i].className = allTabs[i].className.replace(' active', '');
    }
    btn.className += ' active';
    renderApps();
  }

  function renderApps() {
    var list = document.getElementById('appList');
    var searchTerm = document.getElementById('searchBox').value.toLowerCase();
    var html = '';
    for (var i = 0; i < appsData.length; i++) {
      var app = appsData[i];
      if (app.ios_version != currentVersion) continue;
      var name = (currentLang === 'fa') ? app.name_fa : app.name_en;
      if (name.toLowerCase().indexOf(searchTerm) === -1) continue;

      html += '<div class="app-item">';
      html += '<img src="' + app.icon + '" class="app-icon" alt="icon" />';
      html += '<div class="app-info">';
      html += '<p class="app-name">' + name + '</p>';
      html += '<p class="app-source">' + (currentLang === 'fa' ? 'منبع: ' : 'Source: ') + app.source + '</p>';
      html += '</div>';
      html += '<button class="install-button" onclick="location.href=\'' + app.install_url + '\'">' + (currentLang === 'fa' ? 'نصب' : 'Install') + '</button>';
      html += '</div>';
    }
    if (html === '') {
      html = '<p style="text-align:center;">' + (currentLang === 'fa' ? 'برنامه‌ای یافت نشد' : 'No apps found') + '</p>';
    }
    list.innerHTML = html;
  }

  function loadApps() {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', 'apps.json?v=' + new Date().getTime(), true); // prevent cache
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4) {
        if (xhr.status === 200) {
          try {
            appsData = JSON.parse(xhr.responseText);
            renderApps();
          } catch (e) {
            document.getElementById('appList').innerHTML = '<p style="color:red;">Failed to read apps data.</p>';
          }
        } else {
          document.getElementById('appList').innerHTML = '<p style="color:red;">Failed to load apps data.</p>';
        }
      }
    };
    xhr.send();
  }

  loadApps();
</script>

</body>
</html>
